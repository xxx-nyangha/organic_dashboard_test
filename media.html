<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì½˜í…ì¸  ëª©ë¡</title>
    <!-- ... (ì´ì „ì˜ <style> ì½”ë“œëŠ” ê·¸ëŒ€ë¡œ ë‘¡ë‹ˆë‹¤) ... -->
    
    <!-- ğŸ‘‡ [í•µì‹¬] Supabaseì˜ ê³µì‹ JavaScript ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤. -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container">
        <h1>ğŸ–¼ï¸ ì½˜í…ì¸  ëª©ë¡ ë° ìƒì„¸ ì§€í‘œ</h1>
        <p><a href="./index.html">ë©”ì¸ ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a></p>
        <div id="loading-spinner">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
        <div id="media-grid" class="media-grid">
            <!-- ë°ì´í„°ëŠ” JavaScriptê°€ ì±„ì›Œ ë„£ì„ ê²ë‹ˆë‹¤. -->
        </div>
    </div>

    <script>
        // --- ğŸ‘‡ [í•µì‹¬] JavaScriptê°€ Supabaseì— ì§ì ‘ ë°ì´í„°ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤. ---
        
        // 1. Supabase ì ‘ì† ì •ë³´ (ì´ ì •ë³´ëŠ” ì™¸ë¶€ì— ê³µê°œë˜ì–´ë„ ì•ˆì „í•©ë‹ˆë‹¤.)
        const SUPABASE_URL = "YOUR_SUPABASE_URL";
        const SUPABASE_ANON_KEY = "YOUR_SUPABASE_ANON_KEY"; // 'anon' public í‚¤ ì‚¬ìš©!

        // 2. Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // 3. í˜ì´ì§€ê°€ ë¡œë“œë˜ë©´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ ì‹¤í–‰
        window.onload = async function() {
            const mediaGrid = document.getElementById('media-grid');
            const loadingSpinner = document.getElementById('loading-spinner');

            try {
                // 'get_latest_media_with_metrics' DB í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
                const { data, error } = await supabase.rpc('get_latest_media_with_metrics');

                if (error) {
                    throw error; // ì˜¤ë¥˜ê°€ ìˆìœ¼ë©´ catch ë¸”ë¡ìœ¼ë¡œ ë³´ëƒ„
                }

                if (data.length === 0) {
                    mediaGrid.innerHTML = '<p>í‘œì‹œí•  ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                } else {
                    // ê°€ì ¸ì˜¨ ë°ì´í„°ë¡œ HTML ìš”ì†Œë¥¼ ë§Œë“¤ì–´ì„œ ì±„ì›Œ ë„£ìŒ
                    data.forEach(media => {
                        const mediaItem = document.createElement('div');
                        mediaItem.className = 'media-item';
                        
                        let mediaElement = '';
                        if (media.media_type === 1) { // 1: VIDEO
                            // media_urlì´ ì—†ìœ¼ë¯€ë¡œ, permalinkë¡œ ëŒ€ì²´
                            mediaElement = `<a href="${media.permalink}" target="_blank"><div class="video-placeholder">ğŸ¥ ë¹„ë””ì˜¤ ë³´ê¸°</div></a>`;
                        } else {
                            // media_urlì´ ì—†ìœ¼ë¯€ë¡œ, permalinkë¡œ ëŒ€ì²´
                            mediaElement = `<a href="${media.permalink}" target="_blank"><div class="image-placeholder">ğŸ–¼ï¸ ì´ë¯¸ì§€ ë³´ê¸°</div></a>`;
                        }

                        mediaItem.innerHTML = `
                            ${mediaElement}
                            <div class="media-content">
                                <div class="media-stats">
                                    <span>â¤ï¸ <strong>${media.like_count || 0}</strong></span>
                                    <span>ğŸ’¬ <strong>${media.comments_count || 0}</strong></span>
                                    <span>ğŸ¯ ë„ë‹¬: <strong>${media.reach || 0}</strong></span>
                                </div>
                                <p class="media-caption" title="${media.caption || ''}">${(media.caption || '').substring(0, 80)}</p>
                                <p><small>ê²Œì‹œì¼: ${media.post_date}</small></p>
                            </div>
                        `;
                        mediaGrid.appendChild(mediaItem);
                    });
                }

            } catch (error) {
                mediaGrid.innerHTML = `<p class="error">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}</p>`;
            } finally {
                loadingSpinner.style.display = 'none'; // ë¡œë”© ìŠ¤í”¼ë„ˆ ìˆ¨ê¸°ê¸°
            }
        };
    </script>
</body>
</html>
