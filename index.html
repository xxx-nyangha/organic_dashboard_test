<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë‚˜ì˜ ì¸ìŠ¤íƒ€ê·¸ë¨ ëŒ€ì‹œë³´ë“œ</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; background-color: #fafafa; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .dashboard-container { text-align: center; }
        .card { 
            background-color: white;
            border: 1px solid #dbdbdb; 
            border-radius: 8px; 
            padding: 24px; 
            width: 350px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: left;
            transition: all 0.3s ease;
        }
        h1 { color: #262626; margin-bottom: 24px; }
        h2 { margin-top: 0; color: #262626; font-size: 20px; min-height: 24px; }
        p { color: #8e8e8e; font-size: 16px; margin: 12px 0; min-height: 24px;}
        strong { color: #262626; font-size: 18px; }
        .error { color: #ed4956; font-weight: bold; }
        .nav-links { margin-top: 20px; border-top: 1px solid #dbdbdb; padding-top: 20px; }
        .nav-links a { display: block; color: #0095f6; text-decoration: none; font-size: 16px; padding: 8px 0; }
        .nav-links a:hover { text-decoration: underline; }
    </style>
    <!-- ğŸ‘‡ Supabase ê³µì‹ JavaScript ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸° -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

    <div class="dashboard-container">
        <h1>ğŸ“Š ë‚˜ì˜ ì¸ìŠ¤íƒ€ê·¸ë¨ ëŒ€ì‹œë³´ë“œ</h1>
        <div class="card">
            <!-- ë°ì´í„°ê°€ ì±„ì›Œì§ˆ ê³µê°„ -->
            <h2 id="username-display">@ë¡œë”©ì¤‘...</h2>
            <p><strong id="followers-display">...</strong> ëª…ì˜ íŒ”ë¡œì›Œ</p>
            <p><strong id="media-count-display">...</strong> ê°œì˜ ê²Œì‹œë¬¼</p>
            
            <div id="error-display" style="display: none;">
                <h2>âš ï¸ ì˜¤ë¥˜ ë°œìƒ</h2>
                <p class="error" id="error-message"></p>
            </div>

            <div class="nav-links">
                <!-- ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” ë§í¬ (íŒŒì¼ ì´ë¦„ì„ ì •í™•íˆ ë§ì¶°ì£¼ì„¸ìš”) -->
                <a href="./history.html">ğŸ“ˆ ê³„ì • ì§€í‘œ ê¸°ë¡ ë³´ê¸°</a>
                <a href="./media.html">ğŸ–¼ï¸ ì½˜í…ì¸ ë³„ ìƒì„¸ ì§€í‘œ ë³´ê¸°</a>
            </div>
        </div>
    </div>

    <script>
        // --- ğŸ‘‡ JavaScriptê°€ Supabaseì— ì§ì ‘ ë°ì´í„°ë¥¼ ìš”ì²­í•˜ëŠ” í•µì‹¬ ë¡œì§ ---
        
        // 1. Supabase ì ‘ì† ì •ë³´
        const SUPABASE_URL = "https://lmzreioocratunlxlams.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtenJlaW9vY3JhdHVubHhsYW1zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4NjQ2NTIsImV4cCI6MjA4MDQ0MDY1Mn0.4i6EZxi1-0UqqN08hPSqIOwvHSxGIuxenDTpYmL-s8M"; // 'anon' public í‚¤ ì‚¬ìš©!

        // 2. Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // 3. í˜ì´ì§€ê°€ ë¡œë“œë˜ë©´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ ì‹¤í–‰
        window.onload = async function() {
            // HTML ìš”ì†Œë“¤ì„ ë¯¸ë¦¬ ì°¾ì•„ë†“ê¸°
            const usernameEl = document.getElementById('username-display');
            const followersEl = document.getElementById('followers-display');
            const mediaCountEl = document.getElementById('media-count-display');
            const errorDisplayEl = document.getElementById('error-display');
            const errorMessageEl = document.getElementById('error-message');

            try {
                // DBì˜ 'instagram_metrics' í…Œì´ë¸”ì—ì„œ ê°€ì¥ ìµœì‹  ë°ì´í„° 1ê°œë§Œ ê°€ì ¸ì˜µë‹ˆë‹¤.
                // Flask app.pyì˜ ì½”ë“œì™€ ì •í™•íˆ ë™ì¼í•œ ì—­í• ì„ í•©ë‹ˆë‹¤.
                const { data, error } = await supabase
                    .from('instagram_metrics')
                    .select('followers, media_count') // usernameì€ ì´ í…Œì´ë¸”ì— ì—†ìœ¼ë¯€ë¡œ ì œì™¸
                    .order('collect_date', { ascending: false })
                    .limit(1)
                    .single();

                if (error) {
                    throw error; // ì˜¤ë¥˜ê°€ ìˆìœ¼ë©´ catch ë¸”ë¡ìœ¼ë¡œ ë³´ëƒ„
                }

                if (data) {
                    // ì„±ê³µì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ìœ¼ë©´, HTML ë‚´ìš©ì„ ì±„ì›Œ ë„£ìŠµë‹ˆë‹¤.
                    // usernameEl.innerText = `@${data.username}`; // usernameì€ í˜„ì¬ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŒ
                    usernameEl.innerText = "ê³„ì • í˜„í™©"; // ì„ì‹œ í…ìŠ¤íŠ¸
                    followersEl.innerText = data.followers;
                    mediaCountEl.innerText = data.media_count;
                } else {
                    throw new Error("ê°€ì ¸ì˜¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ìë™í™” ë¡œë´‡ì´ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.");
                }

            } catch (error) {
                // ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í•˜ë©´, ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
                usernameEl.parentElement.style.display = 'none'; // ê¸°ì¡´ ì •ë³´ ìˆ¨ê¸°ê¸°
                errorDisplayEl.style.display = 'block'; // ì—ëŸ¬ ë°•ìŠ¤ ë³´ì´ê¸°
                errorMessageEl.innerText = error.message;
            }
        };
    </script>
</body>
</html>
