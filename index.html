<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>INSTAGRAM DASHBOARD</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; background-color: #fafafa; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .dashboard-container { text-align: center; }
        .card { 
            background-color: white;
            border: 1px solid #dbdbdb; 
            border-radius: 8px; 
            padding: 24px; 
            width: 350px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: left;
            transition: all 0.3s ease;
        }
        h1 { color: #262626; margin-bottom: 24px; }
        h2 { margin-top: 0; color: #262626; font-size: 20px; min-height: 24px; }
        p { color: #8e8e8e; font-size: 16px; margin: 12px 0; min-height: 24px;}
        strong { color: #262626; font-size: 18px; }
        .error { color: #ed4956; font-weight: bold; }
        .nav-links { margin-top: 20px; border-top: 1px solid #dbdbdb; padding-top: 20px; }
        .nav-links a { display: block; color: #0095f6; text-decoration: none; font-size: 16px; padding: 8px 0; }
        .nav-links a:hover { text-decoration: underline; }
        /* ëª©ë¡ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .metrics-list { list-style-type: none; padding-left: 0; }
        .metrics-list li { margin-bottom: 8px; }
    </style>
    <!-- ğŸ‘‡ Supabase ê³µì‹ JavaScript ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸° -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="dashboard-container">
        <h1>ğŸ“Š ë‚˜ì˜ ì¸ìŠ¤íƒ€ê·¸ë¨ ëŒ€ì‹œë³´ë“œ</h1>
        
        <!-- ì²« ë²ˆì§¸ ì¹´ë“œ: ê³„ì • í˜„í™© -->
        <div class="card">
            <h2 id="username-display">@ë¡œë”©ì¤‘...</h2>
            <p><strong id="followers-display">...</strong> ëª…ì˜ íŒ”ë¡œì›Œ</p>
            <p><strong id="media-count-display">...</strong> ê°œì˜ ê²Œì‹œë¬¼</p>
            
            <div id="error-display" style="display: none;">
                <h2>âš ï¸ ì˜¤ë¥˜ ë°œìƒ</h2>
                <p class="error" id="error-message"></p>
            </div>
            <div class="nav-links">
                <a href="./history.html">ğŸ“ˆ ê³„ì • ì§€í‘œ ê¸°ë¡ ë³´ê¸°</a>
                <a href="./media.html">ğŸ–¼ï¸ ì½˜í…ì¸ ë³„ ìƒì„¸ ì§€í‘œ ë³´ê¸°</a>
            </div>
        </div>

        <!-- ======================================================== -->
        <!-- ğŸ‘‡ğŸ‘‡ğŸ‘‡ ì—¬ê¸°ì— ìƒˆë¡œìš´ ì¹´ë“œë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤! ğŸ‘‡ğŸ‘‡ğŸ‘‡ -->
        <!-- ======================================================== -->

        <!-- ë‘ ë²ˆì§¸ ì¹´ë“œ: ìˆ˜ì§‘ ì¤‘ì¸ ì§€í‘œ ëª©ë¡ -->
        <div class="card" style="margin-top: 20px;">
            <h2>âš™ï¸ ìˆ˜ì§‘ ì¤‘ì¸ ì¼ì¼ ì§€í‘œ</h2>
            <ul class="metrics-list">
                <li><b>ë„ë‹¬</b> (reach)</li>
                <li><b>ë…¸ì¶œ</b> (views)</li>
                <li><b>í”„ë¡œí•„ ë°©ë¬¸</b> (profile_views)</li>
                <li><b>ì´ ìƒí˜¸ì‘ìš©</b> (total_interactions)</li>
                <li><b>ì¢‹ì•„ìš”</b> (likes)</li>
                <li><b>ëŒ“ê¸€</b> (comments)</li>
                <li><b>ê³µìœ </b> (shares)</li>
            </ul>
        </div>

    </div>

    <script>
        // --- ğŸ‘‡ JavaScript ë¡œì§ì€ ë³€ê²½ ì—†ì´ ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤ ---
        
        const SUPABASE_URL = "https://lmzreioocratunlxlams.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtenJlaW9vY3JhdHVubHhsYW1zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4NjQ2NTIsImV4cCI6MjA4MDQ0MDY1Mn0.4i6EZxi1-0UqqN08hPSqIOwvHSxGIuxenDTpYmL-s8M";
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        window.onload = async function() {
            const usernameEl = document.getElementById('username-display');
            const followersEl = document.getElementById('followers-display');
            const mediaCountEl = document.getElementById('media-count-display');
            const errorDisplayEl = document.getElementById('error-display');
            const errorMessageEl = document.getElementById('error-message');
            
            try {
                // 'daily_account_metrics' í…Œì´ë¸”ì—ì„œ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
                // (ê¸°ì¡´ 'instagram_metrics'ì—ì„œ í…Œì´ë¸” ì´ë¦„ì„ ë³€ê²½í–ˆìŠµë‹ˆë‹¤)
                const { data, error } = await supabase
                    .from('daily_account_metrics')
                    .select('follower_count, media_count') // 'follower_count' ë“± ì»¬ëŸ¼ ì´ë¦„ í™•ì¸
                    .order('date', { ascending: false })
                    .limit(1)
                    .single();

                if (error) throw error;
                
                if (data) {
                    usernameEl.innerText = "ê³„ì • í˜„í™©";
                    // Supabase í…Œì´ë¸”ì˜ ì»¬ëŸ¼ ì´ë¦„ì— ë§ê²Œ ìˆ˜ì •
                    followersEl.innerText = data.follower_count || '...';
                    mediaCountEl.innerText = data.media_count || '...';
                } else {
                    throw new Error("ê°€ì ¸ì˜¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ìë™í™” ë¡œë´‡ì´ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.");
                }

            } catch (error) {
                usernameEl.parentElement.style.display = 'none';
                errorDisplayEl.style.display = 'block';
                errorMessageEl.innerText = error.message;
            }
        };
    </script>
</body>
</html>
